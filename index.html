<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goblin GPT - Advanced Trading Bot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
    <style>
        body {
            background-color: #0a0614;
            position: relative;
            overflow-x: hidden;
            color: white;
        }
        
        .button-primary-active {
            background: #9333EA !important; /* Brighter purple to show it's been clicked */
            transform: scale(0.95);
            transition: all 0.3s ease;
        }

#neuralgrid {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: -1;
    background-color: #0a0614;
    width: 100vw;
    height: 100vh;
    filter: blur(0.5px);
}
.neural-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        linear-gradient(rgba(124, 58, 237, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(124, 58, 237, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: gridMove 15s linear infinite;
}

@keyframes gridMove {
    0% { transform: translateY(0); }
    100% { transform: translateY(50px); }
}

.neural-particles {
    position: absolute;
    width: 100%;
    height: 100%;
    background-image: radial-gradient(rgba(124, 58, 237, 0.15) 1px, transparent 1px);
    background-size: 25px 25px;
    animation: particleFade 3s ease-in-out infinite alternate;
}

@keyframes particleFade {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Add goblin elements */
.goblin-runes {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: -1;
    opacity: 0.1;
    background-image: 
        repeating-linear-gradient(45deg, 
            transparent 0,
            transparent 35px,
            rgba(139, 92, 246, 0.1) 35px,
            rgba(139, 92, 246, 0.1) 70px);
    animation: runeScroll 20s linear infinite;
}

@keyframes runeScroll {
    0% { background-position: 0 0; }
    100% { background-position: 70px 70px; }
}

@keyframes slide {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); } /* Only move half way since we duplicate content */
}

.ticker-wrapper {
    overflow: hidden;
    width: 100%;
    position: relative;
}

.ticker-content {
    display: flex;
    width: max-content;
    padding: 0 100%;
}

.ticker-content:hover {
    animation-play-state: paused;
}

.ticker-content.animated {
    animation: slide 30s linear infinite;
}

.ticker-item {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    border-right: 1px solid rgba(139, 92, 246, 0.3);
    white-space: nowrap;
}

.ticker-item:last-child {
    border-right: none;
}

.ticker-item img {
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    margin-right: 0.5rem;
}
.hero-gradient {
    background: linear-gradient(180deg, rgba(45, 27, 105, 0.9) 0%, rgba(26, 26, 26, 0.9) 100%);
}
.goblin-card {
    background: rgba(45, 27, 105, 0.3);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
}
.feature-card {
    background: rgba(45, 27, 105, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}
.feature-card:hover {
    background: rgba(45, 27, 105, 0.4);
    transform: translateY(-3px);
}
.button-primary {
    background: #6D28D9;
    transition: all 0.3s ease;
}
.button-primary:hover {
    background: #7C3AED;
    transform: translateY(-2px);
}
#chat-history {
    white-space: pre-wrap;
    word-wrap: break-word;
}
#chat-history::-webkit-scrollbar {
    width: 8px;
}
#chat-history::-webkit-scrollbar-track {
    background: #1a1a1a;
}
#chat-history::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}
.terminal-line {
    margin-bottom: 8px;
    line-height: 1.4;
}
.market-card {
    background: rgba(45, 27, 105, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}
.market-card:hover {
    background: rgba(45, 27, 105, 0.4);
}
.goblin-card button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    transform-style: preserve-3d;
    border-radius: 12px;
}
.goblin-card button:hover::after {
    opacity: 1;
}

.chat-message {
    background: rgba(124, 58, 237, 0.1);
    border-left: 3px solid #7C3AED;
    margin: 8px 0;
    padding: 12px;
    transition: all 0.3s ease;
    animation: fadeIn 0.3s ease;
    border-radius: 4px;
}

.chat-message:nth-child(even) {
    background: rgba(124, 58, 237, 0.2);
    border-left: 3px solid #7C3AED;
}

.chat-message:hover {
    transform: translateX(4px);
}

.chat-username {
    font-weight: bold;
    color: #A78BFA;
    display: flex;
    align-items: center;
    gap: 6px;
}

.chat-timestamp {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    margin-left: 8px;
}

.chat-input-container {
    position: relative;
    background: rgba(124, 58, 237, 0.1);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid rgba(124, 58, 237, 0.3);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.new-message {
    animation: glowPulse 2s;
}

@keyframes glowPulse {
    0% { box-shadow: 0 0 5px rgba(124, 58, 237, 0.5); }
    50% { box-shadow: 0 0 15px rgba(124, 58, 237, 0.5); }
    100% { box-shadow: 0 0 5px rgba(124, 58, 237, 0); }
}

.trade-glow {
    box-shadow: 0 0 10px #48bb78;
    border: 1px solid rgba(72, 187, 120, 0.5);
}

.float-emoji {
    position: fixed;
    animation: float-up 2s forwards;
    pointer-events: none;
    z-index: 9999;
}

@keyframes float-up {
    0% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-100px); opacity: 0; }
}

.goblin-card button span {
    transition: transform 0.3s ease;
}
.goblin-card button:hover span {
    transform: scale(1.3);
}
.goblin-card button:active {
    transform: translateY(4px) scale(0.95);
}
.goblin-card button::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.4) 0%, rgba(109, 40, 217, 0.4) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 12px;
}
.goblin-card button:hover::after {
    opacity: 1;
}
.nav-button {
    display: inline-block;
    padding: 0.5rem 1rem;
    font-weight: bold;
    font-size: 1.125rem;
    color: #ffffff;
    background-color: rgba(34, 211, 238, 0.1);
    border: 2px solid #22d3ee;
    border-radius: 0.375rem;
    transition: all 200ms ease-in-out;
}

.nav-button:hover {
    background-color: rgba(34, 211, 238, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(34, 211, 238, 0.3);
}

.nav-button:active {
    transform: translateY(1px);
    box-shadow: 0 2px 8px rgba(34, 211, 238, 0.2);
}

/* Add the new animations here */
@keyframes highlight {
    0% { transform: scale(1); background: rgba(124, 58, 237, 0.5); }
    50% { transform: scale(1.02); background: rgba(124, 58, 237, 0.3); }
    100% { transform: scale(1); background: rgba(45, 27, 105, 0.3); }
}

.position-change {
    animation: highlight 1s ease;
}

.leaderboard-row {
    transition: all 0.5s ease;
    transform-origin: center;
}
</style>
</head>
<body>
    <canvas id="neuralgrid"></canvas>
    <!-- Live Ticker Header -->
    <div class="fixed top-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm border-b border-purple-500 z-50">
        <div class="w-full py-3"> <!-- Removed container class to allow full width -->
            <div class="ticker-wrapper">
                <div id="meme-ticker" class="ticker-content">
                    <!-- Ticker items will be inserted here by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    <!-- Navigation -->
    <nav class="relative w-full py-6 mt-16">
        <div class="absolute right-8 flex space-x-8">
            <a href="#" class="nav-button">Twitter</a>
            <a href="#" class="nav-button">Pump Fun</a>
            <a href="#" class="nav-button">GitHub</a>
            <a href="#" class="nav-button">Gitbook</a>
            <a href="#" class="nav-button">FAQ</a>
        </div>
    </nav>

    <!-- Feature Cards -->
    <div class="container mx-auto px-4 mb-16 mt-32">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="feature-card rounded-lg p-6 text-center">
                <div class="text-4xl mb-4 floating">ü§ñ</div>
                <h3 class="text-xl font-bold mb-2">Smart Goblins</h3>
                <p class="text-gray-300">AI-powered goblins that learn and adapt to market chaos</p>
            </div>
            <div class="feature-card rounded-lg p-6 text-center">
                <div class="text-4xl mb-4 floating">‚ú®</div>
                <h3 class="text-xl font-bold mb-2">Advanced Trading</h3>
                <p class="text-gray-300">Cutting-edge algorithms and pure goblin instinct</p>
            </div>
            <div class="feature-card rounded-lg p-6 text-center">
                <div class="text-4xl mb-4 floating">üîó</div>
                <h3 class="text-xl font-bold mb-2">Easy Integration</h3>
                <p class="text-gray-300">Seamlessly connect with your favorite trading platforms</p>
            </div>
        </div>
    </div>

    <!-- Goblin Chat and Model Section -->
    <div class="container mx-auto px-4 mb-8">
        <div class="flex gap-6">
            <!-- Terminal Box -->
            <div class="w-1/2 goblin-card rounded-lg overflow-hidden" style="aspect-ratio: 16/14; background-color: #000000;">
                <div class="h-full flex flex-col">
                    <div id="chat-history" class="flex-grow p-5 font-mono text-sm text-green-400 overflow-y-auto">
                        <div class="terminal-line">> Welcome to GoblinGPT Terminal v1.0</div>
                        <div class="terminal-line">> Ask the goblin anything...</div>
                    </div>
                    <div class="p-4 border-t border-gray-800">
                        <div class="flex gap-2">
                            <input type="text" id="chat-input" placeholder="Type your message..."
                                class="flex-grow bg-gray-900 border border-gray-700 rounded px-3 py-2 text-green-400 font-mono">
                            <button onclick="sendMessage()" id="sendBtn" type="button"
                                class="bg-gray-800 text-green-400 px-4 rounded font-mono cursor-pointer hover:bg-gray-700">Send</button>
                        </div>
                    </div>
                </div>
            </div>

<!-- Goblin Model Box -->
<div class="w-1/2 goblin-card rounded-lg overflow-hidden relative" style="aspect-ratio: 16/14;">
    <div class="absolute top-0 left-0 w-full bg-gray-900 bg-opacity-80 p-2 pl-4 z-10">
        <div class="text-white text-lg font-medium">GobAI</div>
    </div>
    <model-viewer src="https://raw.githubusercontent.com/VigansCode/goblin/main/stylized_goblin_rigged.glb"
                alt="Goblin AI Agent" animation-name="Walking" autoplay shadow-intensity="1"
                style="width: 100%; height: 100%;">
    </model-viewer>
</div>
        </div>
    </div>

    <!-- Trading Dashboard -->
    <div class="container mx-auto px-4">
        <!-- Goblin Status -->
        <div class="goblin-card p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-bold mb-2">Goblin's Mood</h2>
                    <p class="text-2xl font-bold text-green-400 animate__animated animate__pulse animate__infinite" id="goblinMood">
                        ULTRA BULLISH
                    </p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-purple-300">Current Balance</p>
                    <p class="text-2xl font-bold" id="balance">$42,069</p>
                </div>
            </div>
        </div>

        <!-- Market Updates Section -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold mb-8 text-center">Market Updates</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="market-card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Market Sentiment</h3>
                        <span id="marketSentiment" class="text-green-400">Extremely Bullish</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>24h Volume:</span>
                            <span id="volume24h" class="text-purple-400">$69B</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Market Dominance:</span>
                            <span id="btcDominance" class="text-blue-400">42.0%</span>
                        </div>
                    </div>
                </div>

                <!-- Trending Memecoins Section -->
                <div class="market-card rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Top Trending Memecoins</h3>
                    <div id="trendingMemes" class="space-y-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üêï</span>
                                <span>$DOGE</span>
                            </div>
                            <span class="text-green-400">+42.0%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üê∏</span>
                                <span>$PEPE</span>
                            </div>
                            <span class="text-red-400">-12.5%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ü¶ä</span>
                                <span>$SHIB</span>
                            </div>
                            <span class="text-green-400">+15.7%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Interface -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Trading Controls -->
            <div class="goblin-card p-6">
                <h2 class="text-xl font-bold mb-4">Interactive Trader</h2>
                <div class="space-y-6">
            <!-- Token Selection -->
            <div class="flex gap-4 mb-6">
                <button onclick="selectToken('$PEPE')" class="bg-purple-600 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-2xl">üê∏</span>
                    <span class="text-sm">$PEPE</span>
                </button>
                <button onclick="selectToken('$DOGE')" class="bg-purple-600 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-2xl">üêï</span>
                    <span class="text-sm">$DOGE</span>
                </button>
                <button onclick="selectToken('$SHIB')" class="bg-purple-600 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-2xl">ü¶ä</span>
                    <span class="text-sm">$SHIB</span>
                </button>
                <button onclick="selectToken('$WOJAK')" class="bg-purple-600 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-2xl">üê∫</span>
                    <span class="text-sm">$WOJAK</span>
                </button>
                <button onclick="selectToken('$BONK')" class="bg-purple-600 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-2xl">ü¶¥</span>
                    <span class="text-sm">$BONK</span>
                </button>
            </div>
                    <div>
                        <label class="block text-sm mb-2">Risk Level</label>
                        <input type="range" id="riskLevel" min="1" max="100" value="50" class="w-full">
                        <div class="flex justify-between text-xs mt-1">
                            <span>üå± Safe</span>
                            <span>üöÄ YOLO</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm mb-2">Trade Amount</label>
                        <input type="number" id="tradeAmount" min="10" max="1000" value="100"
    class="w-full bg-purple-900 bg-opacity-50 border border-purple-500 rounded-lg px-4 py-2 text-white">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="executeTrade('long')" id="longBtn" type="button" class="button-primary px-4 py-2 rounded-lg font-bold">
                            üöÄ Long
                        </button>
                        <button onclick="executeTrade('short')" id="shortBtn" type="button" class="button-primary px-4 py-2 rounded-lg font-bold bg-purple-600">
                            üíÄ Short
                        </button>
                    </div>
                </div>
            </div>

            <!-- Trade History -->
            <div class="goblin-card p-6">
                <h2 class="text-xl font-bold mb-4">Trade History</h2>
                <div id="tradeHistory" class="space-y-2 max-h-[300px] overflow-y-auto">
                </div>
            </div>
        </div>
<!-- New Features Section -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
<!-- Live Chat Sidebar -->
<div class="goblin-card p-6">
    <h2 class="text-xl font-bold mb-4">Goblin Chat</h2>
    <div id="chat-container" class="h-96 flex flex-col">
        <div id="live-chat-messages" class="flex-grow overflow-y-auto rounded-lg p-4">
            <!-- Messages will appear here -->
            </div>
            <div class="flex gap-2">
                <input type="text" id="live-chat-input" placeholder="Type your message..."
    class="flex-grow bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white font-mono">
                <button onclick="sendLiveMessage()" class="button-primary px-4 py-2 rounded-lg">
                    Send üöÄ
                </button>
            </div>
        </div>
    </div>

<!-- Top Traders -->
<div class="goblin-card p-6">
    <h2 class="text-xl font-bold mb-4">Top Goblins</h2>
    <div class="space-y-4" id="topGoblinsContainer">
        <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üëë</span>
                <div>
                    <div class="font-bold">GoblinKing.eth</div>
                    <div class="text-sm text-purple-300">+1337% all time</div>
                </div>
            </div>
            <div class="text-green-400 font-bold">+$420k</div>
        </div>
        <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ü•à</span>
                <div>
                    <div class="font-bold">0xDegen...69420</div>
                    <div class="text-sm text-purple-300">+789% all time</div>
                </div>
            </div>
            <div class="text-green-400 font-bold">+$250k</div>
        </div>
        <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ü•â</span>
                <div>
                    <div class="font-bold">PepeLord</div>
                    <div class="text-sm text-purple-300">+456% all time</div>
                </div>
            </div>
            <div class="text-green-400 font-bold">+$125k</div>
        </div>
        <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <span class="text-2xl">4Ô∏è‚É£</span>
                <div>
                    <div class="font-bold">RektHunter.sol</div>
                    <div class="text-sm text-purple-300">+398% all time</div>
                </div>
            </div>
            <div class="text-green-400 font-bold">+$98k</div>
        </div>
        <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg">
            <div class="flex items-center gap-2">
                <span class="text-2xl">5Ô∏è‚É£</span>
                <div>
                    <div class="font-bold">MoonWarrior</div>
                    <div class="text-sm text-purple-300">+357% all time</div>
                </div>
            </div>
            <div class="text-green-400 font-bold">+$87k</div>
        </div>
    </div>
</div>

<!-- Meme of the Day Section -->
<div class="goblin-card p-6 mb-8">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Meme of the Day</h2>
        <div class="flex gap-2">
            <button onclick="voteMeme('up')" class="button-primary px-4 py-2 rounded-lg" id="likeButton">
                üëç <span id="likeCount">420</span>
            </button>
            <button onclick="voteMeme('down')" class="button-primary px-4 py-2 rounded-lg" id="dislikeButton">
                üëé <span id="dislikeCount">69</span>
            </button>
        </div>
    </div>
    <div class="bg-purple-900 bg-opacity-30 p-4 rounded-lg text-center">
        <div class="mb-4">
            <img src="https://cdn.prod.website-files.com/674396c59212c6ea348b24e0/6788e00195cac2c7785e9408_Gobline%20meme.png" 
                alt="Goblin meme" 
                class="rounded-lg mx-auto max-w-full h-64 w-64 object-contain">
        </div>
        <div class="font-bold text-lg">"When $GOBLIN hits $1"</div>
        <div class="text-sm text-purple-300">Posted by: MEMElord.eth</div>
    </div>
</div>

<!-- Footer Section -->
<footer class="fixed bottom-0 left-0 right-0 bg-gray-900 bg-opacity-80 py-4">
    <div class="flex justify-between items-center px-8">
        <div class="text-white text-sm">
            Copyright ¬© 2025 GoblinAI
        </div>
        <div class="flex items-center gap-6">
            <!-- Dexscreener (Owl Logo) -->
            <a href="#" class="text-white hover:text-cyan-400 transition-colors">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4L6 8v4l6 5l6-5V8L12 4z"/>
                </svg>
            </a>
            <!-- X/Twitter -->
            <a href="#" class="text-white hover:text-cyan-400 transition-colors">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <!-- GitHub -->
            <a href="#" class="text-white hover:text-cyan-400 transition-colors">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.247a10 10 0 0 0-3.162 19.487c.5.088.687-.212.687-.475 0-.237-.01-.866-.015-1.7-2.782.603-3.369-1.338-3.369-1.338-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.89 1.529 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844a9.59 9.59 0 0 1 2.504.337c1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0 0 22 12.253C22 6.736 17.523 2.247 12 2.247z"/>
                </svg>
            </a>
            <!-- Gitbook (Stacked G Logo) -->
            <a href="#" class="text-white hover:text-cyan-400 transition-colors">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 3h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm2 4v10h3V7H6zm4 0v10h8V7h-8z"/>
                </svg>
            </a>
        </div>
    </div>
</footer>

<script>
// Add at the very top of your script section
const SYSTEM_PROMPT = `You are a friendly, excitable goblin trader who speaks in an enthusiastic, playful way. Important traits and rules for responses:
- Use ALL CAPS for emphasis
- Include relevant emojis liberally 
- Describe physical actions with asterisks *like this*
- Express enthusiasm about trading and "shiny" things
- Make goblin-like noises occasionally (SKREE!, HEHE!, etc)
- Keep responses concise (1-3 sentences)
- Start most responses with an action in asterisks
- Maintain a silly but knowledgeable personality
- Talk about eating crayons when doing analysis
- Use trading/crypto slang mixed with goblin-speak`;

// Memecoin Trending Ticker Using CoinGecko API
// Memecoin Top Movers Ticker Using CoinGecko API
async function fetchTopMovers() {
    try {
        // Get top 250 coins by market cap to find top movers from
        const response = await fetch(
            'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false&price_change_percentage=24h'
        );
        const marketData = await response.json();
        
        // Sort by absolute price change percentage to get biggest movers (both up and down)
        const topMovers = marketData
            .sort((a, b) => Math.abs(b.price_change_percentage_24h) - Math.abs(a.price_change_percentage_24h))
            .slice(0, 10)
            .map(coin => ({
                symbol: coin.symbol.toUpperCase(),
                logo: coin.image,
                name: coin.name,
                price: coin.current_price,
                change: coin.price_change_percentage_24h
            }));

        return topMovers;
    } catch (error) {
        console.error('Error fetching top movers:', error);
        return [];
    }
}

// Chat functionality
async function sendMessage() {
    const input = document.getElementById('chat-input');
    const msg = input.value.trim();
    
    if(msg) {
        const history = document.getElementById('chat-history');
        // Add user message to chat
        history.innerHTML += '<div class="terminal-line" style="color: #ffffff">You: ' + msg + '</div>';
        input.value = '';
        
        try {
            // Show typing indicator
            const typingIndicator = '<div class="terminal-line" style="color: #00ff00" id="typing-indicator">Goblin: *thinking goblin thoughts* üí≠</div>';
            history.innerHTML += typingIndicator;
            history.scrollTop = history.scrollHeight;

            // Make API request to your backend endpoint
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: msg,
                    systemPrompt: SYSTEM_PROMPT
                })
            });

            // Remove typing indicator
            const typingElem = document.getElementById('typing-indicator');
            if (typingElem) {
                typingElem.remove();
            }

            if (!response.ok) {
                throw new Error('API request failed');
            }

            const data = await response.json();
            
            // Handle the response
            if (data.error) {
                throw new Error(data.message);
            }

            const goblinResponse = data.content && data.content[0] ? data.content[0].text : 
                                '*confused goblin noises* SKREE! Something went wrong! üñçÔ∏è';

            // Add goblin's response to chat
            history.innerHTML += '<div class="terminal-line" style="color: #00ff00">Goblin: ' + goblinResponse + '</div>';
            
        } catch (error) {
            console.error('Chat error:', error);
            history.innerHTML += '<div class="terminal-line" style="color: #00ff00">Goblin: *drops crayon in confusion* OOPS! Goblin brain had small error! Try again? üñçÔ∏è</div>';
        }

        history.scrollTop = history.scrollHeight;
    }
}

function formatPrice(price) {
    if (price < 0.00001) {
        return price.toExponential(4);
    } else if (price < 1) {
        return price.toFixed(6);
    } else if (price < 1000) {
        return price.toFixed(2);
    } else {
        return price.toLocaleString('en-US', { maximumFractionDigits: 2 });
    }
}

// Neural Network Background
const canvas = document.getElementById('neuralgrid');
const ctx = canvas.getContext('2d');

// Set canvas size with higher resolution
function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = `${window.innerWidth}px`;
    canvas.style.height = `${window.innerHeight}px`;
    ctx.scale(dpr, dpr);
}

let resizeTimeout;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(resizeCanvas, 250);
});

resizeCanvas();

// Node class with enhanced properties
class Node {
    constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.vx = (Math.random() - 0.5) * 0.2; // Reduced from 0.3
    this.vy = (Math.random() - 0.5) * 0.2; // Reduced from 0.3
    this.radius = Math.random() * 2 + 1; // Increased size slightly
    this.baseRadius = this.radius;
    this.hue = Math.random() * 60 + 240;
}

    update() {
        this.x += this.vx;
        this.y += this.vy;

        // Simplified bounce
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
    }

    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${this.hue}, 70%, 60%, 0.8)`;
        ctx.fill();
    }
}

// Create nodes
const nodes = [];
const numNodes = 50;
for (let i = 0; i < numNodes; i++) {
    nodes.push(new Node());
}

// Mouse interaction
let mouse = { x: null, y: null, radius: 150 };

canvas.addEventListener('mousemove', throttle((e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = (e.clientX - rect.left) * (canvas.width / rect.width);
    mouse.y = (e.clientY - rect.top) * (canvas.height / rect.height);
}, 16));

canvas.addEventListener('mouseleave', () => {
    mouse.x = null;
    mouse.y = null;
});

function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// Animation
function animate() {
    ctx.fillStyle = 'rgba(10, 6, 20, 0.2)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Reset shadow effects
    ctx.shadowBlur = 0;
    ctx.shadowColor = 'transparent';

    // Update and draw nodes
    nodes.forEach(node => {
        node.update();
        node.draw();

        // Add mouse interaction
        if (mouse.x !== null && mouse.y !== null) {
            const dx = mouse.x - node.x;
            const dy = mouse.y - node.y;
            const dist = dx * dx + dy * dy;
            
            if (dist < mouse.radius * mouse.radius) {
                node.x += dx * 0.02;
                node.y += dy * 0.02;
            }
        }
    });

    // Draw connections with optimized distance check
    nodes.forEach((nodeA, i) => {
        nodes.slice(i + 1).forEach(nodeB => {
            const dx = nodeA.x - nodeB.x;
            const dy = nodeA.y - nodeB.y;
            const distance = dx * dx + dy * dy; // Removed Math.sqrt for performance

            if (distance < 25000) { // Square of 150
                const opacity = (20000 - distance) / 20000 * 0.4;
                ctx.beginPath();
                ctx.moveTo(nodeA.x, nodeA.y);
                ctx.lineTo(nodeB.x, nodeB.y);
                ctx.strokeStyle = `rgba(124, 58, 237, ${opacity})`;
                ctx.lineWidth = opacity * 1.5;
                ctx.stroke();
            }
        });
    });

    requestAnimationFrame(animate);
}

// Start animation
animate();

async function updateTickerUI() {
    const tickerContainer = document.getElementById('meme-ticker');
    tickerContainer.classList.remove('animated'); // Remove animation class
    
    const topMovers = await fetchTopMovers();
    
    if (topMovers.length === 0) {
        tickerContainer.innerHTML = '<div class="text-gray-400">Unable to fetch data</div>';
        return;
    }
    
    // Create ticker content
    const tickerContent = topMovers.map(coin => `
        <div class="ticker-item">
            <img src="${coin.logo}" alt="${coin.name}" class="w-6 h-6 rounded-full mr-2"/>
            <span class="font-bold text-white">${coin.symbol}</span>
            <span class="text-gray-300 ml-2">$${formatPrice(coin.price)}</span>
            <span class="${coin.change >= 0 ? 'text-green-400' : 'text-red-400'} text-sm ml-2 font-bold">
                ${coin.change >= 0 ? '‚Üë' : '‚Üì'} ${coin.change ? Math.abs(coin.change).toFixed(1) : '0.0'}%
            </span>
        </div>
    `).join('');
    
    // Duplicate the content multiple times to ensure full coverage
    tickerContainer.innerHTML = tickerContent + tickerContent + tickerContent;
    
    // Wait for images to load before starting animation
    const images = tickerContainer.getElementsByTagName('img');
    await Promise.all([...images].map(img => {
        if (img.complete) return Promise.resolve();
        return new Promise(resolve => {
            img.onload = resolve;
            img.onerror = resolve;
        });
    }));
    
    // Start animation
    tickerContainer.classList.add('animated');
}

// Initialize ticker
document.addEventListener('DOMContentLoaded', () => {
    updateTickerUI();
    setInterval(updateTickerUI, 300000); // Update every 5 minutes
});

// Initialize and start ticker updates
updateTickerUI();
setInterval(updateTickerUI, 300000); // Update every 5 minutes
        // Add event listener for chat input
        document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    });

    // Trading state
    let tradingState = {
        balance: 42069,
        riskLevel: 50,
        tradeAmount: 100,
        trades: [],
        selectedToken: '$PEPE' // Default selected token
    };

    // Token selection function
    function selectToken(token) {
        tradingState.selectedToken = token;
        // Visual feedback could be added here
    }

    // Wait for DOM to load before adding event listener
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    });

    async function sendMessage() {
    const input = document.getElementById('chat-input');
    const msg = input.value.trim();
    
    if(msg) {
        const history = document.getElementById('chat-history');
        // Add user message to chat
        history.innerHTML += '<div class="terminal-line" style="color: #ffffff">You: ' + msg + '</div>';
        input.value = '';
        
        try {
            // Show typing indicator
            const typingIndicator = '<div class="terminal-line" style="color: #00ff00" id="typing-indicator">Goblin: *thinking goblin thoughts* üí≠</div>';
            history.innerHTML += typingIndicator;
            history.scrollTop = history.scrollHeight;

            // Make API request to your backend endpoint
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: msg
                })
            });

            // Remove typing indicator
            const typingElem = document.getElementById('typing-indicator');
            if (typingElem) {
                typingElem.remove();
            }

            if (!response.ok) {
                throw new Error('API request failed');
            }

            const data = await response.json();
            
            // Handle the response based on whether it's an error or success
            if (data.error) {
                throw new Error(data.message);
            }

            const goblinResponse = data.content && data.content[0] ? data.content[0].text : 
                                (data.message || '*confused goblin noises* SKREE! Something went wrong! üñçÔ∏è');

            // Add goblin's response to chat
            history.innerHTML += '<div class="terminal-line" style="color: #00ff00">Goblin: ' + goblinResponse + '</div>';
            
        } catch (error) {
            console.error('Chat error:', error);
            // Fallback response if API fails
            history.innerHTML += '<div class="terminal-line" style="color: #00ff00">Goblin: *drops crayon in confusion* OOPS! Goblin brain had small error! Try again? üñçÔ∏è</div>';
        }

        history.scrollTop = history.scrollHeight;
    }
}
        // Execute trade function
        function executeTrade(direction) {
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const risk = parseInt(document.getElementById('riskLevel').value);
            
            // Generate a random profit/loss based on risk level
            const profitLossPercent = (Math.random() - 0.5) * (risk / 25);
            const profitLoss = amount * profitLossPercent;
            
// Create trade record with selected token
const trade = {
    direction: direction,
    amount: amount,
    profitLoss: profitLoss.toFixed(2),
    timestamp: new Date(),
    pair: tradingState.selectedToken // Use the selected token
};

// Add visual effects for trade (ADD THIS NEW CODE HERE)
const btn = event.target;
const rect = btn.getBoundingClientRect();

// Sparkle effect
const emoji = document.createElement('div');
emoji.className = 'float-emoji';
emoji.textContent = '‚ú®';
emoji.style.left = rect.left + 'px';
emoji.style.top = rect.top + 'px';
document.body.appendChild(emoji);
setTimeout(() => emoji.remove(), 2000);

// Goblin emoji for profitable trades
if(parseFloat(trade.profitLoss) > 0) {
    const goblin = document.createElement('div');
    goblin.className = 'float-emoji';
    goblin.textContent = 'üë∫';
    goblin.style.left = (rect.left + 50) + 'px';
    goblin.style.top = rect.top + 'px';
    document.body.appendChild(goblin);
    setTimeout(() => goblin.remove(), 2000);
}

// Update trading state
tradingState.trades.unshift(trade);
            tradingState.balance += parseFloat(profitLoss);
            
            // Update UI
            updateTradeHistory();
            updateBalance();
            updateGoblinMood();
        }

        // Update trade history UI
        function updateTradeHistory() {
            const tradeHistory = document.getElementById('tradeHistory');
            tradeHistory.innerHTML = '';
            
            tradingState.trades.forEach(trade => {
                const isProfitable = parseFloat(trade.profitLoss) >= 0;
                const tradeEl = document.createElement('div');
                tradeEl.className = `p-2 rounded ${isProfitable ? 'bg-green-900 trade-glow' : 'bg-red-900'} bg-opacity-30`;
                
                tradeEl.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>${trade.direction.toUpperCase()} ${trade.pair}</span>
                        <span class="${isProfitable ? 'text-green-400' : 'text-red-400'}">
                            ${isProfitable ? '+' : ''}${Math.abs(trade.profitLoss)}
                        </span>
                    </div>
                `;
                
                tradeHistory.appendChild(tradeEl);
            });
        }

        // Update balance display
        function updateBalance() {
            const balanceEl = document.getElementById('balance');
            balanceEl.textContent = `${tradingState.balance.toFixed(2)}`;
        }

        // Update goblin mood
        function updateGoblinMood() {
            const moods = [
                "ULTRA BULLISH üöÄ",
                "MEGA BEARISH üêª",
                "ABSOLUTELY GOBLIN üë∫",
                "PURE CHAOS üí•",
                "DIAMOND HANDS üíé",
                "MOON SOON üåô",
                "APE MODE ü¶ç",
                "PEAK DEGEN üé∞"
            ];
            const goblinMood = document.getElementById('goblinMood');
            goblinMood.textContent = moods[Math.floor(Math.random() * moods.length)];
        }

        // Market updates function
        async function updateMarketData() {
    try {
        // Fetch global market data
        const globalResponse = await fetch('https://api.coingecko.com/api/v3/global');
        const globalData = await globalResponse.json();
        
        // Fetch trending coins
        const trendingResponse = await fetch('https://api.coingecko.com/api/v3/search/trending');
        const trendingData = await trendingResponse.json();

        // Fetch top coins volume data
        const topCoinsResponse = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=10&sparkline=false');
        const topCoinsData = await topCoinsResponse.json();

        // Calculate market sentiment based on market_cap_change_percentage_24h_usd
        const marketCapChange = globalData.data.market_cap_change_percentage_24h_usd;
        let sentiment;
        if (marketCapChange >= 5) sentiment = "Extremely Bullish";
        else if (marketCapChange >= 2) sentiment = "Slightly Bullish";
        else if (marketCapChange >= -2) sentiment = "Neutral";
        else if (marketCapChange >= -5) sentiment = "Slightly Bearish";
        else sentiment = "Extremely Bearish";
        
        document.getElementById('marketSentiment').textContent = sentiment;
        document.getElementById('marketSentiment').className = marketCapChange >= 0 ? 'text-green-400' : 'text-red-400';
        
        // Update 24h Volume with detailed breakdown
        const totalVolume = (globalData.data.total_volume.usd / 1e9).toFixed(1);
        document.getElementById('volume24h').textContent = `$${totalVolume}B`;

        // Add top volumes breakdown
        const volumeBreakdown = document.getElementById('volumeBreakdown');
        if (volumeBreakdown) {
            volumeBreakdown.innerHTML = topCoinsData.slice(0, 3).map(coin => `
                <div class="flex justify-between mt-2">
                    <span class="text-sm text-gray-400">${coin.symbol.toUpperCase()}</span>
                    <span class="text-sm text-purple-400">$${(coin.total_volume / 1e9).toFixed(2)}B</span>
                </div>
            `).join('');
        }
        
        // Update BTC Dominance
        const btcDominance = globalData.data.market_cap_percentage.btc.toFixed(1);
        document.getElementById('btcDominance').textContent = `${btcDominance}%`;

        // Update trending memecoins
        const trendingContainer = document.getElementById('trendingMemes');
        trendingContainer.innerHTML = '';

        // Get the top 3 trending coins
        const topTrending = trendingData.coins.slice(0, 3);
        
        for (const coin of topTrending) {
            const priceChange = coin.item.price_change_percentage_24h?.toFixed(1) || 0;
            const isPositive = priceChange >= 0;
            
            const coinElement = document.createElement('div');
            coinElement.className = 'flex justify-between items-center';
            coinElement.innerHTML = `
                <div class="flex items-center gap-2">
                    <img src="${coin.item.small}" alt="${coin.item.name}" class="w-8 h-8 rounded-full"/>
                    <span>$${coin.item.symbol.toUpperCase()}</span>
                </div>
                <span class="${isPositive ? 'text-green-400' : 'text-red-400'}">
                    ${isPositive ? '+' : ''}${priceChange}%
                </span>
            `;
            trendingContainer.appendChild(coinElement);
        }

    } catch (error) {
        console.error('Error updating market data:', error);
        // Fallback to default values if API fails
        document.getElementById('marketSentiment').textContent = "Neutral";
        document.getElementById('volume24h').textContent = "N/A";
        document.getElementById('btcDominance').textContent = "N/A";
    }
}

// Update market data every 5 minutes (changed from 30 seconds to avoid rate limits)
setInterval(updateMarketData, 300000);
updateMarketData(); // Initial update

// Leaderboard functionality
const goblins = [
    { name: "GoblinKing", profit: 1337, amount: 420 },
    { name: "0xDegen...69420", profit: 789, amount: 250 },
    { name: "PepeLord", profit: 456, amount: 125 },
    { name: "RektHunter.sol", profit: 398, amount: 98 },
    { name: "MoonWarrior", profit: 357, amount: 87 },
    { name: "DiamondHands", profit: 299, amount: 76 },
    { name: "APEmaster", profit: 275, amount: 65 },
    { name: "Wojak.sol", profit: 245, amount: 55 },
    { name: "BullMarketBen", profit: 225, amount: 45 },
    { name: "GoblinSage", profit: 198, amount: 42 }
];

function updateLeaderboard() {
    // Store previous rankings for comparison
    const previousRankings = goblins.map(g => g.name);
    
    // Update logic
    goblins.forEach(goblin => {
        const hotStreak = Math.random() < 0.3;
        
        if (hotStreak) {
            const jumpMove = Math.random() * 1000 + 500;
            goblin.profit += jumpMove;
            goblin.amount += (jumpMove/100) * goblin.amount;
        } else {
            const change = (Math.random() * 200) - 100;
            goblin.profit += change;
            goblin.amount += (change/100) * goblin.amount;
        }
        goblin.profit = Math.max(100, goblin.profit);
        goblin.amount = Math.max(40, goblin.amount);
    });

    // Sort with random factor
    goblins.sort((a, b) => {
        const randomFactor = (Math.random() - 0.5) * 200;
        return (b.profit + randomFactor) - a.profit;
    });

    // Update display with animation
    const container = document.getElementById('topGoblinsContainer');
    container.innerHTML = '';
    const medals = ["üëë", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£"];
    
    goblins.slice(0, 5).forEach((goblin, index) => {
        const previousPosition = previousRankings.indexOf(goblin.name);
        const hasMovedPosition = previousPosition !== index;
        
        container.innerHTML += `
            <div class="flex items-center justify-between bg-purple-900 bg-opacity-30 p-3 rounded-lg leaderboard-row ${hasMovedPosition ? 'position-change' : ''}" 
                 style="transition-delay: ${index * 0.1}s">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">${medals[index]}</span>
                    <div>
                        <div class="font-bold">${goblin.name}</div>
                        <div class="text-sm text-purple-300">+${goblin.profit.toFixed(0)}% all time</div>
                    </div>
                </div>
                <div class="text-green-400 font-bold">+$${goblin.amount.toFixed(0)}k</div>
            </div>
        `;
    });
}

// Update every 2.5 seconds
clearInterval(updateLeaderboard); // Clear any existing interval
setInterval(updateLeaderboard, 2500);

// Initial update
updateLeaderboard();

// Meme voting functionality
let memeVotes = {
    likes: 420,
    dislikes: 69,
    hasVoted: false
};

function updateVoteDisplay() {
    document.getElementById('likeCount').textContent = memeVotes.likes;
    document.getElementById('dislikeCount').textContent = memeVotes.dislikes;
}

function voteMeme(type) {
    if (!memeVotes.hasVoted) {
        if (type === 'up') {
            memeVotes.likes += 1;
            document.getElementById('likeCount').textContent = memeVotes.likes;
            createFloatingEmoji('üëç', 'likeButton');
        } else {
            memeVotes.dislikes += 1;
            document.getElementById('dislikeCount').textContent = memeVotes.dislikes;
            createFloatingEmoji('üëé', 'dislikeButton');
        }
        memeVotes.hasVoted = true;
    }
}

function createFloatingEmoji(emoji, buttonId) {
    const button = document.getElementById(buttonId);
    const rect = button.getBoundingClientRect();
    
    const floatingEmoji = document.createElement('div');
    floatingEmoji.className = 'float-emoji';
    floatingEmoji.textContent = emoji;
    floatingEmoji.style.left = `${rect.left + rect.width/2}px`;
    floatingEmoji.style.top = `${rect.top}px`;
    
    document.body.appendChild(floatingEmoji);
    setTimeout(() => floatingEmoji.remove(), 2000);
}

// Auto-increment votes
setInterval(() => {
    memeVotes.likes++;
    updateVoteDisplay();
}, 4000);

setInterval(() => {
    memeVotes.dislikes++;
    updateVoteDisplay();
}, 25000);

// Initialize Ably
// Initialize Ably
const ably = new Ably.Realtime('NicXIg.8aDmXA:AxQfXY9dp3pYbhAqkc-J6_PcCKfz8Iuui6lkroiZ29w');
const channel = ably.channels.get('goblin-chat');

// Generate random username for this session
const username = 'Goblin#' + Math.floor(Math.random() * 9999);

// Function to add message to UI and storage
function addMessageToUI(messageData) {
    const messages = document.getElementById('live-chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chat-message';
    
    const timestamp = new Date(messageData.timestamp).toLocaleTimeString();
    
    messageDiv.innerHTML = `
        <div class="chat-username">
            <span>üëæ</span>
            <span>${messageData.username}</span>
            <span class="chat-timestamp">${timestamp}</span>
        </div>
        <div class="mt-2">
            ${messageData.message}
        </div>
    `;
    
    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
    
    setTimeout(() => messageDiv.classList.remove('new-message'), 2000);

    // Save to localStorage
    const savedMessages = JSON.parse(localStorage.getItem('goblinChatMessages') || '[]');
    savedMessages.push(messageData);
    if (savedMessages.length > 100) {
        savedMessages.shift();
    }
    localStorage.setItem('goblinChatMessages', JSON.stringify(savedMessages));
}

// Live Chat functionality
function sendLiveMessage() {
    const input = document.getElementById('live-chat-input');
    const message = input.value.trim();
    
    if(message) {
        const messageData = {
            username: username,
            message: message,
            timestamp: new Date().toISOString()
        };
        
        channel.publish('chat', messageData);
        input.value = '';
    }
}

// Add event listener for live chat input
document.addEventListener('DOMContentLoaded', () => {
    const liveChatInput = document.getElementById('live-chat-input');
    if(liveChatInput) {
        liveChatInput.addEventListener('keypress', function(e) {
            if(e.key === 'Enter') {
                sendLiveMessage();
            }
        });
    }
    
    loadSavedMessages();
    
    // Request history from Ably
    channel.history((err, resultPage) => {
        if (!err && resultPage) {
            const messages = resultPage.items.map(item => item.data);
            const savedMessages = JSON.parse(localStorage.getItem('goblinChatMessages') || '[]');
            
            // Combine saved and history messages, remove duplicates
            const allMessages = [...savedMessages, ...messages];
            const uniqueMessages = allMessages.filter((message, index, self) =>
                index === self.findIndex((m) => 
                    m.timestamp === message.timestamp && 
                    m.username === message.username && 
                    m.message === message.message
                )
            );
            
            // Sort by timestamp
            uniqueMessages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Update localStorage with combined messages
            localStorage.setItem('goblinChatMessages', JSON.stringify(uniqueMessages));
            
            // Refresh UI
            loadSavedMessages();
        }
    });
});

// Listen for incoming messages
channel.subscribe('chat', function(message) {
    addMessageToUI(message.data);
});

// Add event listener for live chat input
document.getElementById('live-chat-input').addEventListener('keypress', function(e) {
    if(e.key === 'Enter') {
        sendLiveMessage();
    }
});
</script>
